{% extends 'spots/base.html' %}

{% block title %}スポット投稿 - 旅ログマップ{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h2><i class="fas fa-plus me-2"></i>新しいスポットを投稿</h2>
            </div>
            <div class="card-body">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    
                    <div class="mb-3">
                        <label for="{{ form.title.id_for_label }}" class="form-label">スポット名 *</label>
                        {{ form.title }}
                        {% if form.title.errors %}
                        <div class="text-danger">{{ form.title.errors }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.description.id_for_label }}" class="form-label">説明 *</label>
                        {{ form.description }}
                        {% if form.description.errors %}
                        <div class="text-danger">{{ form.description.errors }}</div>
                        {% endif %}
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.latitude.id_for_label }}" class="form-label">緯度 *</label>
                                {{ form.latitude }}
                                {% if form.latitude.errors %}
                                <div class="text-danger">{{ form.latitude.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.longitude.id_for_label }}" class="form-label">経度 *</label>
                                {{ form.longitude }}
                                {% if form.longitude.errors %}
                                <div class="text-danger">{{ form.longitude.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.address.id_for_label }}" class="form-label">住所</label>
                        {{ form.address }}
                        {% if form.address.errors %}
                        <div class="text-danger">{{ form.address.errors }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.image.id_for_label }}" class="form-label">画像</label>
                        {{ form.image }}
                        {% if form.image.errors %}
                        <div class="text-danger">{{ form.image.errors }}</div>
                        {% endif %}
                        <div class="form-text">JPEGまたはPNG形式の画像をアップロードできます。</div>
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{% url 'home' %}" class="btn btn-secondary me-md-2">
                            <i class="fas fa-times me-2"></i>キャンセル
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane me-2"></i>投稿する
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 位置情報取得のヒント -->
        <div class="card mt-4">
            <div class="card-header">
                <h5><i class="fas fa-info-circle me-2"></i>位置情報の取得方法</h5>
            </div>
            <div class="card-body">
                <p>緯度・経度は以下の方法で取得できます：</p>
                <ul>
                    <li><strong>Google Maps</strong>: 地図上で右クリック → 座標をクリック</li>
                    <li><strong>スマートフォン</strong>: 位置情報アプリや地図アプリで確認</li>
                    <li><strong>GPS機器</strong>: 専用のGPS機器で測定</li>
                </ul>
                <p class="mb-0">
                    <small class="text-muted">
                        例: 東京駅の場合、緯度: 35.6812, 経度: 139.7671
                    </small>
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// 画像プレビュー機能
document.getElementById('id_image').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            // プレビュー要素があれば表示
            let preview = document.getElementById('image-preview');
            if (!preview) {
                preview = document.createElement('img');
                preview.id = 'image-preview';
                preview.className = 'img-thumbnail mt-2';
                preview.style.maxWidth = '200px';
                e.target.parentNode.appendChild(preview);
            }
            preview.src = e.target.result;
        };
        reader.readAsDataURL(file);
    }
});
</script>
{% endblock %}

